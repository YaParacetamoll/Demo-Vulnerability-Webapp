#!/bin/bash

# Database credentials
DB_HOST="database"
DB_USER="root"
DB_PASSWORD="123456$"
DB_NAME="posty"

# Admin credentials
ADMIN_USERNAME="admin"
ADMIN_PASSWORD="it-network-waf$" 

# Connect to the MySQL server
mysql -u "$DB_USER" -p"$DB_PASSWORD" << EOF

# Create the database
CREATE DATABASE IF NOT EXISTS $DB_NAME;

# Use the database
USE $DB_NAME;

# Create the users table
CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL 
);

# Create the posts table
CREATE TABLE IF NOT EXISTS posts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    content TEXT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

# Insert the admin user
INSERT INTO users (username, password) VALUES ('$ADMIN_USERNAME', '$ADMIN_PASSWORD');

# Get the admin user's ID
SET @admin_id = LAST_INSERT_ID();

# Insert other users
INSERT INTO users (username, password) VALUES ('user1', 'passwordx1');
INSERT INTO users (username, password) VALUES ('user2', 'passwordy2');
INSERT INTO users (username, password) VALUES ('user3', 'passwordz3');

# Insert admin posts
INSERT INTO posts (user_id, content) VALUES (@admin_id, 'This is the first post from the admin!');
INSERT INTO posts (user_id, content) VALUES (@admin_id, 'Welcome to Posty Social Media App!');

# Insert posts from other users
INSERT INTO posts (user_id, content) VALUES (@admin_id + 1, 'This is a post from user1.'); 
INSERT INTO posts (user_id, content) VALUES (@admin_id + 2, 'Hello from user2!');
INSERT INTO posts (user_id, content) VALUES (@admin_id + 3, 'User3 checking in.');
INSERT INTO posts (user_id, content) VALUES (@admin_id + 1, 'Another post from user1.');
INSERT INTO posts (user_id, content) VALUES (@admin_id + 2, 'User2\'s second post.');

EOF

echo "Database initialized successfully."

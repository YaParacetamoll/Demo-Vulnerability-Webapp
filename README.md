
> [!NOTE]
> โชคดี



## Services
   * MySql
   * Adminer | port 8081 http://localhost:8081/
   * Webapp | Port 8080 http://localhost:8080/
     *  CKEditor Configurator Tool : http://localhost:8080/public/ckeditor/samples/index.html

## วิธีรันด้วย Docker
1. compose up
   ```bash
   cd Demo-Vulnerability-Webapp
   docker-compose up
   ```
2. setup database
   ```txt
   เปิดหน้า http://localhost:8080/setup.php ใน browser
   ```
## Hash stylesheet & script

```bash
cat <path> | openssl sha512 -binary | openssl base64 -A
```
```html
<script src="/<path>" integrity="sha512-<hash result>" ></script>
```

## คำอธิบายช่องโหว่ของแอพพลิเคชัน 

โค้ดที่ให้มามีช่องโหว่หลายจุดที่ผู้โจมตีสามารถใช้ประโยชน์ได้ ซึ่งรวมถึง:


**1. SQL Injection:**

* **แบบฟอร์มล็อกอิน:** คิวรี SQL ของแบบฟอร์มล็อกอินมีช่องโหว่เนื่องจากอินพุตของผู้ใช้ (`$username` และ `$password`) ถูกต่อเข้ากับสตริงคิวรีโดยตรงโดยไม่มีการตรวจสอบความถูกต้องหรือการกำหนดพารามิเตอร์ที่เหมาะสม ผู้โจมตีสามารถแทรกโค้ด SQL ที่เป็นอันตรายลงในช่องชื่อผู้ใช้หรือรหัสผ่านเพื่อจัดการคิวรีและอาจเข้าถึงฐานข้อมูลโดยไม่ได้รับอนุญาต
* **การสร้างโพสต์:** ในทำนองเดียวกัน ตรรกะการสร้างโพสต์มีช่องโหว่เนื่องจากตัวแปร `$content` ถูกแทรกเข้าไปในคิวรี SQL โดยตรงโดยไม่มีการตรวจสอบความถูกต้อง ผู้โจมตีสามารถแทรกโค้ด SQL ลงในเนื้อหาโพสต์เพื่อจัดการฐานข้อมูล
* **การลบโพสต์:** ตรรกะการลบโพสต์ยังมีช่องโหว่เนื่องจาก `$post_id` ไม่ได้รับการตรวจสอบความถูกต้องก่อนที่จะใช้ในคิวรี SQL
* Sample Try Username : `admin` , Password : `WTF' OR id = '1`

**2. Cross-Site Scripting (XSS):**

* **การแสดงโพสต์:** เนื้อหาโพสต์ (`$row["content"]`) จะแสดงโดยไม่ผ่านการ escape อย่างถูกต้องโดยใช้ `htmlspecialchars()` ซึ่งหมายความว่าหากผู้โจมตีจัดการแทรกโค้ด JavaScript ที่เป็นอันตรายลงในโพสต์ (เช่น ผ่านโปรแกรมแก้ไขข้อความแบบ rich text) โค้ดนั้นจะถูกเรียกใช้ในเบราว์เซอร์ของผู้ใช้รายอื่นที่ดูโพสต์ ซึ่งอาจทำให้ผู้โจมตีขโมยคุกกี้ ข้อมูลเซสชัน หรือแม้แต่ควบคุมบัญชีของผู้ใช้ได้

**3. Cross-Site Request Forgery (CSRF):**

* **การลบโพสต์:** แบบฟอร์มการลบโพสต์ไม่มีกลไกการป้องกัน CSRF ผู้โจมตีสามารถสร้างเว็บไซต์ที่เป็นอันตรายซึ่งหลอกล่อให้ผู้ใช้ที่ล็อกอินส่งแบบฟอร์มการลบโดยที่พวกเขาไม่รู้ตัว ซึ่งนำไปสู่การลบโพสต์โดยไม่ได้ตั้งใจ

**4. การตรวจสอบอินพุตที่ขาดหายไป:**

* **การสมัครใช้งาน (ไม่ได้ใช้งาน):** แม้ว่าจะไม่มีการให้ตรรกะการสมัครใช้งาน แต่สิ่งสำคัญคือต้องทราบว่าการตรวจสอบอินพุตที่หายไปในแบบฟอร์มการลงทะเบียนผู้ใช้สามารถนำไปสู่ปัญหาต่างๆ รวมถึง:
    * **รหัสผ่านที่อ่อนแอ:** หากไม่มีการบังคับใช้ข้อกำหนดความซับซ้อนของรหัสผ่าน ผู้ใช้อาจเลือกรหัสผ่านที่อ่อนแอซึ่งคาดเดาหรือถอดรหัสได้ง่าย
    * **ข้อมูลไม่ถูกต้อง:** หากอินพุตของผู้ใช้ (เช่น ที่อยู่อีเมล ชื่อผู้ใช้) ไม่ได้รับการตรวจสอบความถูกต้อง ข้อมูลที่ไม่ถูกต้องหรือเป็นอันตรายอาจถูกเก็บไว้ในฐานข้อมูล
* **เนื้อหาโพสต์ (จำกัด):** แม้ว่าโค้ดจะกำหนดให้ต้องกรอกเนื้อหาโพสต์ แต่ก็ไม่ได้บังคับใช้กฎการตรวจสอบความถูกต้องอื่นๆ (เช่น ความยาวสูงสุด อักขระที่อนุญาต) ซึ่งอาจนำไปสู่ปัญหาเกี่ยวกับการจัดเก็บหรือแสดงข้อมูล

**5. การจัดการข้อผิดพลาดที่ขาดหายไป:**

* **ข้อผิดพลาดของฐานข้อมูล:** โค้ดไม่ได้จัดการข้อผิดพลาดของฐานข้อมูลที่อาจเกิดขึ้นอย่างเหมาะสม หากคิวรีฐานข้อมูลล้มเหลว แอปพลิเคชันอาจหยุดทำงานหรือแสดงข้อความแสดงข้อผิดพลาดที่เปิดเผยข้อมูลที่ละเอียดอ่อนต่อผู้ใช้

**6. การจัดเก็บรหัสผ่านที่ไม่ปลอดภัย:**

* **(ไม่แสดง):** โค้ดไม่ได้แสดงวิธีจัดเก็บรหัสผ่านในฐานข้อมูล หากรหัสผ่านถูกจัดเก็บเป็นข้อความธรรมดา จะมีความเสี่ยงสูงที่จะถูกขโมยหากฐานข้อมูลถูกบุกรุก ควรแฮชรหัสผ่านโดยใช้อัลกอริธึมการแฮชแบบทางเดียวที่แข็งแกร่ง (เช่น bcrypt, Argon2) เสมอ

**7. ความเป็นไปได้ของช่องโหว่อื่นๆ:**

* **การแทรกโค้ด (หากใช้ `eval()` หรือฟังก์ชันที่คล้ายกัน):** โค้ดไม่ได้ใช้ `eval()` แต่หากใช้โดยไม่มีการตรวจสอบอินพุตที่เหมาะสม อาจมีช่องโหว่ต่อการแทรกโค้ด
* **การแทรกคำสั่ง OS (หากใช้ `exec()`, `system()` ฯลฯ):** ในทำนองเดียวกัน หากโค้ดดำเนินการคำสั่งเชลล์ตามอินพุตของผู้ใช้โดยไม่มีการตรวจสอบความถูกต้อง อาจมีช่องโหว่ต่อการแทรกคำสั่ง OS
* **ช่องโหว่การอัปโหลดไฟล์ (หากมีการใช้งานการอัปโหลดไฟล์):** หากแอปพลิเคชันอนุญาตให้อัปโหลดไฟล์ โดยไม่มีการตรวจสอบความถูกต้องและมาตรการรักษาความปลอดภัยที่เหมาะสม อาจมีช่องโหว่ต่อการโจมตีต่างๆ (เช่น การอัปโหลดสคริปต์ที่เป็นอันตรายซึ่งปลอมตัวเป็นรูปภาพ)

**คำแนะนำ:**

* **ใช้คำสั่ง Prepared Statements หรือ Parameterized Queries:** นี่เป็นวิธีที่มีประสิทธิภาพมากที่สุดในการป้องกันช่องโหว่ SQL injection
* **ตรวจสอบความถูกต้องและตรวจสอบอินพุตของผู้ใช้ทั้งหมด:** ใช้ฟังก์ชันที่เหมาะสมเช่น `htmlspecialchars()` สำหรับการเข้ารหัสเอาต์พุตและเทคนิคการตรวจสอบความถูกต้องอื่นๆ เพื่อป้องกัน XSS และการโจมตีจากอินพุตอื่นๆ
* **ใช้การป้องกัน CSRF:** ใช้โทเค็น CSRF เพื่อป้องกันการโจมตี CSRF
* **แฮชรหัสผ่านอย่างปลอดภัย:** ใช้อัลกอริธึมการแฮชที่แข็งแกร่งเช่น bcrypt หรือ Argon2 เพื่อจัดเก็บรหัสผ่าน
* **ใช้การจัดการข้อผิดพลาดที่แข็งแกร่ง:** จัดการข้อผิดพลาดของฐานข้อมูลอย่างเหมาะสมและหลีกเลี่ยงการเปิดเผยข้อมูลที่ละเอียดอ่อนในข้อความแสดงข้อผิดพลาด
* **ตรวจสอบความถูกต้องของการอัปโหลดไฟล์:** หากคุณใช้งานการอัปโหลดไฟล์ ให้ตรวจสอบประเภทไฟล์ ขนาด และเนื้อหาเพื่อป้องกันการอัปโหลดไฟล์ที่เป็นอันตราย
* **อัปเดตการอ้างอิงเป็นประจำ:** อัปเดต PHP เวอร์ชัน ไลบรารี (เช่น CKEditor) และซอฟต์แวร์ฐานข้อมูลของคุณอยู่เสมอเพื่อแก้ไขช่องโหว่ด้านความปลอดภัยที่ทราบ
* **ดำเนินการตรวจสอบความปลอดภัยและการทดสอบการเจาะระบบ:** ประเมินแอปพลิเคชันของคุณเป็นประจำเพื่อหาช่องโหว่

โดยการแก้ไขช่องโหว่เหล่านี้ คุณสามารถปรับปรุงความปลอดภัยของเว็บแอปพลิเคชันของคุณได้อย่างมากและปกป้องข้อมูลของผู้ใช้ของคุณ โปรดจำไว้ว่าความปลอดภัยเป็นกระบวนการที่ต่อเนื่อง และคุณควรได้รับข้อมูลเกี่ยวกับภัยคุกคามล่าสุดและแนวปฏิบัติที่ดีที่สุดอยู่เสมอ
